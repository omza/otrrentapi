<!DOCTYPE html>
<html>

<head>
    {% block head %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>otrrent</title>
    <!-- Path to Framework7 Library CSS-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/framework7.material.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/framework7.material.colors.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/material-icons.css') }}">
    {% endblock %}

</head>

<body class="theme-green">

    <!-- Panels overlay-->
    <div class="panel-overlay"></div>

    <!-- Left panel with panel-cover effect-->
    <div class="panel panel-left panel-cover">
        <div class="view navbar-fixed">
            <div class="pages">
                <div data-page="panel-left" class="page">
                    <div class="navbar">
                        <div class="navbar-inner">
                            <div class="center">otrrent</div>
                        </div>
                    </div>
                    <div class="page-content">

                        <div class="content-block-title">Menü</div>
                        <div class="list-block">
                            <ul>
                                <li>
                                    <a href="{{ url_for('ui.history') }}" class="item-link item-content close-panel" data-ignore-cache="true">
                                        <div class="item-media"><i class="material-icons">history</i></div>
                                        <div class="item-inner item-title">Verlauf</div>
                                    </a>
                                </li>
                                <li>
                                    <a id="settings" href="{{ url_for('ui.settings') }}" class="item-link item-content close-panel" data-ignore-cache="true">
                                        <div class="item-media"><i class="material-icons">settings</i></div>
                                        <div class="item-inner item-title">Einstellungen</div>
                                    </a>
                                </li>

                                <li>
                                    <a id="adsfree" href="{{ url_for('ui.about') }}?menu=adsfree" class="item-link item-content close-panel">
                                        <div class="item-media"><i class="material-icons">notifications_off</i></div>
                                        <div class="item-inner item-title">Werbefrei</div>
                                    </a>
                                </li>

                                <li>
                                    <a id="getprouser" href="{{ url_for('ui.about') }}?menu=getprouser" class="item-link item-content close-panel">
                                        <div class="item-media"><i class="material-icons">person_add</i></div>
                                        <div class="item-inner item-title">Pro User</div>
                                    </a>
                                </li>

                            </ul>
                        </div>

                        <div class="content-block-title">App</div>
                        <div class="list-block">
                            <ul>
                                <li>
                                    <a id="rate" href="{{ url_for('ui.about') }}?menu=rate" class="item-link item-content close-panel">
                                        <div class="item-media"><i class="material-icons">star</i></div>
                                        <div class="item-inner item-title">Bewerten</div>
                                    </a>
                                </li>
                                <li>
                                    <a id="privacy" href="{{ url_for('www.privacy') }}" target="_blank" class="item-link item-content close-panel external">
                                        <div class="item-media"><i class="material-icons">lock</i></div>
                                        <div class="item-inner item-title">Datenschutzerklärung</div>
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('ui.about') }}" class="item-link item-content close-panel">
                                        <div class="item-media"><i class="material-icons">info</i></div>
                                        <div class="item-inner item-title">Über</div>
                                    </a>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Views-->
    <div class="views">

        <!-- Your main view, should have "view-main" class-->
        <div class="view view-main">


            <!-- Pages, because we need fixed-through navbar and toolbar, it has additional appropriate classes-->
            <div class="pages navbar-fixed">
                <!-- Page, data-page contains page name-->
                <div data-page="{{ pagetitle }}" class="page">

                    <!-- Top Navbar-->
                    {% block navbar %}
                    <div class="navbar">
                        <div class="navbar-inner">

                            <!-- We have home navbar without left link-->
                            <div class="center sliding">{{ title }}</div>
                            <div class="right">
                                <!-- Right link contains only icon - additional "icon-only" class--><a href="#" class="link icon-only open-panel"> <i class="icon icon-bars"></i></a>
                            </div>

                        </div>
                    </div>
                    {% endblock %}

                    <!-- Search Bar -->
                    {% block searchbar %}
                    {% endblock %}

                    <!-- Scrollable page content-->
                    <div class="page-content">

                        {% block content %}
                        {% endblock %}

                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- Path to Framework7 Library JS-->
    <script type="text/javascript" src="{{ url_for('static', filename='js/framework7.min.js') }}"></script>

    <!-- Path to Fingerprint2 Library JS-->
    <script type="text/javascript" src="{{ url_for('static', filename='js/fingerprint2.min.js') }}"></script>

    <!-- Path to your app js-->
    <script type="text/javascript" src="{{ url_for('static', filename='js/framework7.myandroidapp.js') }}"></script>

    {% if session['deviceuuid'] is none %}
    <script>
        // Login with ClientID and Device Fingerprint
        // --------------------------------------------------------------------------------------
        function OtrrentAuth() {
            // otrentauth constructor

            // attributes
            this.ClientID = localStorage.getItem('ClientID') === null ? '' : localStorage.getItem('ClientID');
            this.Fingerprint = localStorage.getItem('Fingerprint') === null ? '' : localStorage.getItem('Fingerprint');
            this.LoggedIn = false;
            this.SessionTimeout = 0;

            //get a hash, representing your device fingerprint
            if (this.Fingerprint === '') {
                var self = this;
                new Fingerprint2().get(function (result) {
                    self.Fingerprint = result;
                    self.login();
                });
            } else {
                this.login();
            }

            // method to login
            this.login = function () {

                // invoke push REST API call to login or create new user or get client ID
                // pure js !
                if (window.XMLHttpRequest) {
                    // code for modern browsers
                    xhttp = new XMLHttpRequest();
                } else {
                    // code for old IE browsers
                    xhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }

                // async callback success/error
                xhttp.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {

                        // write item in history
                        objResponse = JSON.parse(this.response);

                        this.ClientID = objResponse.ClientId; //a hash, representing your Client ID
                        localStorage.setItem('ClientID', objResponse.ClientId);

                        this.LoggedIn = objResponse.LoggedIn;
                        this.SessionTimeout = objResponse.SessionTimeout;

                    }
                };

                // invoke ajax call
                var url = window.location.origin + '/api/user/login';
                xhttp.open("POST", url, true);

                //set headers
                xhttp.setRequestHeader("dataType", "json");
                xhttp.setRequestHeader("Content-type", "application/json; charset=utf-8");

                // send data
                var PostJson = {
                    "ClientID": this.ClientID,
                    "Fingerprint": this.Fingerprint
                };
                xhttp.send(JSON.stringify(PostJson));

            };
        }

        var Authentification = new OtrrentAuth();

        if (!sessionStorage.cookiedisclaimershown) {

            myApp.addNotification({
                title: 'Cookies',
                message: "Diese Webseite/App verwendet Cookies um im Rahmen Ihrer Sitzung einen Authentifizierungstoken zu speichern. Indem Sie auf OK klicken oder diese Website weiter nutzen, stimmen Sie der Speicherung von Cookies auf Ihrem Endgerät zu. Näheres erfahren Sie aus unserer <a href='{{ url_for('www.privacy') }}' target='_blank' class='external'>Datenschutzerklärung</a>",
                button: {
                    text: 'OK'
                },
                onClose: function () {
                    sessionStorage.cookiedisclaimershown = true;
                }
            });   
        }
    </script>
    {% else %}
    <script>
        // Login with ClientID and Device UUID
        // --------------------------------------------------------------------------------------
        function OtrrentAuth() {
            // otrentauth constructor

            // attributes
            this.ClientID = localStorage.getItem('ClientID') === null ? '' : localStorage.getItem('ClientID');
            this.Fingerprint = "{{ session['deviceuuid'] }}";
            this.LoggedIn = false;
            this.SessionTimeout = 0;


            // invoke push REST API call to login or create new user or get client ID
            // pure js !
            if (window.XMLHttpRequest) {
                // code for modern browsers
                xhttp = new XMLHttpRequest();
            } else {
                // code for old IE browsers
                xhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }

            // async callback success/error
            xhttp.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {

                    // write item in history
                    objResponse = JSON.parse(this.response);

                    this.ClientID = objResponse.ClientId; //a hash, representing your Client ID
                    localStorage.setItem('ClientID', objResponse.ClientId);

                    this.LoggedIn = objResponse.LoggedIn;
                    this.SessionTimeout = objResponse.SessionTimeout;

                }
            };

            // invoke ajax call
            var url = window.location.origin + '/api/user/login';
            xhttp.open("POST", url, true);

            //set headers
            xhttp.setRequestHeader("dataType", "json");
            xhttp.setRequestHeader("Content-type", "application/json; charset=utf-8");

            // send data
            var PostJson = {
                "ClientID": this.ClientID,
                "Fingerprint": this.Fingerprint
            };
            xhttp.send(JSON.stringify(PostJson));

        };

        var Authentification = new OtrrentAuth();

    </script>
    {% endif %}

</body>
</html>