sudo: required
language: python
python: "3.6"
services:
- docker
addons:
  ssh_known_hosts: "$PRODUCTIONSERVER"
script:
- docker build --build-arg FLASK_DEPLOY_MODULE=otrrentapi --build-arg FLASK_DEPLOY_CALLABLE=app
  --build-arg FLASK_DEPLOY_PORT=8001 --build-arg FLASK_DEPLOY_DOMAIN=otrrent.app-workshop.de
  -t otrrent/otrrentapi ./otrrentapi
- docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
- docker push otrrent/otrrentapi
after_success:
- openssl aes-256-cbc -K $encrypted_0a6446eb3ae3_key -iv $encrypted_0a6446eb3ae3_iv -in ~/productionserver.pem.enc -out ~/productionserver.pem -d
- eval "$(ssh-agent -s)"
- chmod 600 ~/productionserver.pem
- sshpass -p "$PASSPHRASE" ssh-add ~/productionserver.pem
- sshpass -e ssh omza@$PRODUCTIONSERVER /opt/otrrentapi/docker-compose up -d
env:
  global:
  - secure: o6Px0f7RwhJ+bez/hqYivZfq6m7Ykc04BEmLRQlWplf7gIPDgZJDiSdZun8+9MDljRL944oyy2heGsXVz8jdT9D7WD35uNvde8/i6tppRNYBzGRGLQmUdO+yxXfeSwDdKH5PAo7QX0JF5fJ/jsPfa0yPL+n42mwi9Pi9IX20FcPcY7iV0uzSI5QkhHzADIlg0bs2WEAra25QqxwVCi1Sknuf/ymHK4K4YUp9Y3LsoRBI/coVOedwk4Z+77LE+sJF2zKauyCoa+4fjun6XpFWGmHgG0RzFXJ1xVJhpzpatb98YPADlvrBY6gLqRdo0vuZ7inpdDHXLVgEg+EmwpgwZsEtURxXDVwIGRllN6jVLvMhnytsOOOz9hkqeujschvS2tAL4gtXiylwWFf9bD3BqAIu/yFk5fM+xt2rsZc4h6yc1DUl/VZaBCDv/N4A21kFPljj1QSR0KKdszsKNFj84sf8zUmfyzd0ycwZ4U8qbjewiZjbQranl4BBrHjKpySmmG2Zzr7QzVjgU5vlXLmowF0nwmYf8rnepxHH5oWxypaIKj36b+TiQMT+B1JIkA6LU3DY8CxtR16BUUMQ/8AW8hzs/Ii7zplGylWnsfN8UG+Nm44RfIw7aYLUuF+bzYwdez/jz4cmyH0kT2JdbVzJtoskOxC4Y4jWsu5d+P9eLvY=
  - secure: I6znCPElyk/qhwRtYVtd943YSf4+QBF3MNsbXBjftJcQUEU49pOtu8lAl6Z0xA/rKV9d3Adnj0Q/k0QNPg+Y4la8TaeHgBEFgVMKmVG0CWmxNmK3tx/1i1MJqj/tK7NztHWdeATVegi8LQPQH1TSV0ZviymAhFaYx0xbmJntksiTNqcbpSYKYo5xx0yXcChQvu/IaeO3XQanKPsHn8S2s97bJ6ljYmbfWdK4Rj3QVjX91QFsTDyDyImHosmqvR3rO9STjBtJbBSRATXzXF+3s2ORzLzJ66jJKWYebofhpUgtoDuZaxK5zGp741bv3brtioLr1VZfGQjEPe4abCAKnA/GROuiwDv+W1YllbxK9yclI6uNpzmW82+Q81xVFX8h6QAAYdmc6xBCeU56WR11woyAgFFbAuWbtgBn3C5Xeha6ZLUikuYMv7maeTz9Mu9xk3NgxLENoMMGVwybZ4DJuFPDmNr5rQUPq3RsUFXauHaIJccJJx62UOny5db16pKG84wrlTdKMAh13IY7DvTk1ZqKTa97cRtJAmY+HQLCNr5jqlSdCHiX6ssv4uz82xNSnypsDpRAR7JhuwABXibOfJOqYJKslSBEzxxmUI0s8XByvH4oc79Urm/nix6fZcrOj+mMRTaDgyFMSsZgW3IkYS1UC+Ff5GDQtBNxwDvI18A=
  - secure: lP9V6rOyBs/xcAxQCku6YW7Fx10g8c/X5rVKI6nFMO/QovG2VkIuC5ewNOIHmMohHNGF/gBgRWSRamKgqVoAtHRLIXm1SHPwtPpadqKOgE6nkuglz8tbK7SGIf2hCHQmhTOq1tRWjLB7J12oxLz1uw/Vw7IEZZYAb1pXjXIBfQzoSiMd/kCeAfND55BkSzpGAS/z27wGMm3DaSF2F4qTPWA+y+dPDZ7AQJXzgoyxK6zjVc5A53yAl+wVXsMjwaq6HU2C8QscBVCCFXuhPsmQvZlnKFD63exs9du407djtP+QWyjRIVkbYsGuML65iKba9Hh69MUmvTVzcCSpUEnP5jRO6fSRYF9wIuV/DNif3TD2CQTvVIrTIOXRxloGKLDrH3Rt0NFxDLo6AVwqHnZbExjX4eegxu5cusr760kSO0VvxcBXYMKW2U04Z7bAnpE//jAg9O61F2LImmJaLX7zNJwN44dU1z+jGty2XwU0TFnAYzgVRAqRBS+Xt46FRKvvWoMlifcA0MV0p2lXs1y3nlmxrchN9smq3HO4Xg/BGMzXqkOxQbIKRMJE1kukJioztcqEVKXJS3NbA0jaFa6Vbn2j+koY8sqj455a0OCecoSOVLUisNFxE5NOJw9hWWu4zsyvugjv+jYAgtAq8nvOtSnwenf6HhTeb/CJ8Ok2mYA=
  - secure: ZuoUV5uxW0vkzAHVwnnaDZ7TQKw9hEwMw9TOs7f813/KehkGS9Ke/9whfg7nrzds4MC8AFUCiwJ4zT4/i83Y7vMbt1cuB+LeD64SCyBqEbuxkYvQUNLa8ixKsfKikjSkwZDJHbFmVIAdV3bmCyhAmwOlT++x7bSGfFLQzAX3cD1X1uAmUhmjvTFzWDJ193UyBkMH/I0JhxzovIeyt2aote1gJs+kaFd78xDiDogNOnMkQQWRUE311EgZm496wGm9JOkkwN/T9QT8ucAhhFGIeMy2BCD1EPrg7Hc8cFKCOQUBOnQayCbB9bnoaNcHIrkxMBgmDKVaYx9Acs4l6IUC/c59N3amIzC7JXq6mxgCNqkuXlbdMTToEAyYq7z6209vbSfQhHZhLV4Otx4TeyE+WmnUxXvLiYi0kCQu+lunjQC8QEpA9tahaSV7ah9XrRxZdtXQIpW09cK1RUJDsQPqIQHPCzEmdH0Z3QbS6KxDLEJMhiJFGr8IZz/n0HUOqq3TDu6fLA6cyXlAW+E7PvWG6NL3+Viu5UhJ2ZA0ywCtWExCzkAmsFNFD/xLL6PviWijp9glKtW+0HrIQYx4hxNjs1l14JbszdnG1W9igUyAD/99Y0F9WepEHUX164wUho1vx4jDatmyLWmi2NTqZQSkIIBH921yDAzA5kOG+8ZfS3I=